<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ğŸ’œ 2 Player Question Game ğŸ’œ</title>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import { getDatabase, ref, set, onValue, get } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

// ğŸ”¥ your firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBGR79jHTrXO71izWaSyWLnW2diUOVk1s4",
  authDomain: "gametest-114ff.firebaseapp.com",
  databaseURL: "https://gametest-114ff-default-rtdb.firebaseio.com",
  projectId: "gametest-114ff",
  storageBucket: "gametest-114ff.firebasestorage.app",
  messagingSenderId: "784588934650",
  appId: "1:784588934650:web:44772fd223df1ac981e843"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// 50 question pairs
const questionPairs = [
  ["what's the worst decision you've ever made?", "what's the best decision you've ever made?"],
  ["what's the worst advice you've ever taken?", "what's the best advice you've ever gotten?"],
  ["what's the best feeling in the world?", "what's the worst feeling in the world?"],
  ["what's something that ended too soon?", "what's something that lasted too long?"]
  // â€¦ add all 50 here
];

let roomCode = "";
let player = "";
let myQuestion = "";

function joinRoom() {
  roomCode = document.getElementById("room").value;
  player = prompt("Are you Player 1 or Player 2? (type 1 or 2)");
  if (player !== "1" && player !== "2") {
    alert("please type 1 or 2");
    return;
  }

  // listen to score
  const scoreRef = ref(db, `rooms/${roomCode}/score${player}`);
  onValue(scoreRef, (snapshot) => {
    const s = snapshot.val();
    if (s !== null) document.getElementById("score").textContent = "Your Score: " + s;
  });

  // listen to both players' questions for debugging (optional)
  onValue(ref(db, `rooms/${roomCode}/player1Question`), () => {});
  onValue(ref(db, `rooms/${roomCode}/player2Question`), () => {});
}

async function chooseNumber() {
  const num = parseInt(document.getElementById("num").value);
  if (num < 1 || num > questionPairs.length) {
    alert("choose a number between 1 and " + questionPairs.length);
    return;
  }

  // write the number to firebase if not already set
  const numRef = ref(db, `rooms/${roomCode}/number`);
  const snapshot = await get(numRef);
  if (!snapshot.exists()) {
    await set(numRef, num);
  }

  // pick a random question for this player and save to firebase
  const pair = questionPairs[num - 1];
  myQuestion = pair[Math.floor(Math.random() * 2)];
  await set(ref(db, `rooms/${roomCode}/player${player}Question`), myQuestion);

  document.getElementById("question").textContent = "Your Question: " + myQuestion;
}

async function guess(same) { // same = true for same, false for different
  const otherPlayer = player === "1" ? "2" : "1";
  const otherSnap = await get(ref(db, `rooms/${roomCode}/player${otherPlayer}Question`));
  if (!otherSnap.exists()) {
    alert("wait for the other player to pick a question!");
    return;
  }

  const otherQuestion = otherSnap.val();
  const actuallySame = myQuestion === otherQuestion;
  const scoreRef = ref(db, `rooms/${roomCode}/score${player}`);
  let currentScore = 0;
  const scoreSnap = await get(scoreRef);
  if (scoreSnap.exists()) currentScore = scoreSnap.val();

  if ((same && actuallySame) || (!same && !actuallySame)) {
    alert("Correct! +1 point ğŸ’–");
    currentScore++;
    set(scoreRef, currentScore);
  } else {
    alert("Oops! Wrong guess ğŸ˜¢");
  }
}

window.joinRoom = joinRoom;
window.chooseNumber = chooseNumber;
window.guessSame = () => guess(true);
window.guessDifferent = () => guess(false);
</script>
</head>
<body>
<h1>ğŸ’œ 2 Player Question Game ğŸ’œ</h1>

<input id="room" placeholder="Enter room code">
<button onclick="joinRoom()">Join Room</button>
<br><br>

<input id="num" type="number" placeholder="1-50" min="1" max="50">
<button onclick="chooseNumber()">Choose Number</button>
<br><br>

<h2 id="question"></h2>
<button onclick="guessSame()">Guess Same</button>
<button onclick="guessDifferent()">Guess Different</button>
<h2 id="score">Your Score: 0</h2>
</body>
</html>
